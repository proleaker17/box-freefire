<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Russo One', sans-serif;
            /* Thematic gradient background for Free Fire */
            background-image: radial-gradient(ellipse at bottom, #fb8500 0%, #0c141c 70%);
            background-attachment: fixed;
            background-size: cover;
            background-repeat: no-repeat;
            overflow: hidden;
            margin: 0;
        }
        
        /* --- Start Screen --- */
        #start-screen {
            background-color: rgba(12, 20, 28, 0.7);
            backdrop-filter: blur(4px);
            transition: opacity 0.5s ease-out;
        }

        .selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
        }

        .selection-item {
            cursor: pointer;
            border: 4px solid transparent;
            transition: all 0.2s ease-in-out;
            border-radius: 0.5rem;
            position: relative;
            background-color: rgba(255, 255, 255, 0.05);
            aspect-ratio: 1 / 1;
        }
        
        .selection-item:hover {
            transform: scale(1.05);
            border-color: #ff8c00;
        }
        
        .selection-item.selected {
            border-color: #ffae42;
            box-shadow: 0 0 20px rgba(255, 174, 66, 0.7);
        }
        
        .selection-item .checkmark {
            display: none;
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            background-color: #ffae42;
            border-radius: 50%;
            color: white;
            font-family: sans-serif;
        }

        .selection-item.selected .checkmark {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-button {
            transition: all 0.2s ease-in-out;
            background: linear-gradient(180deg, #ffb703 0%, #fb8500 100%);
            box-shadow: 0 5px 0 #d06d00;
            border-color: #ffc94a;
            color: #1e293b;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        .action-button:hover { 
            filter: brightness(1.1);
        }
        .action-button:active { 
            box-shadow: 0 3px 0 #d06d00; 
            filter: brightness(0.95);
            transform: translateY(2px);
        }
        .action-button:disabled {
            filter: grayscale(0.8);
            opacity: 0.5;
            pointer-events: none;
        }


        /* --- Game Screen --- */
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        .screen-shake-active {
            animation: screen-shake 0.5s ease-out;
        }
        @keyframes screen-shake {
            0%, 100% { transform: translate(0, 0); }
            10%, 90% { transform: translate(-5px, 0) rotate(-1deg); }
            20%, 80% { transform: translate(5px, 0) rotate(1deg); }
            30%, 50%, 70% { transform: translate(-5px, 5px) rotate(0); }
            40%, 60% { transform: translate(5px, -5px) rotate(0); }
        }

        #crate-wrapper {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70vw;
            height: 70vh;
            max-width: 450px;
            max-height: 450px;
            transition: transform 0.2s ease-in-out, opacity 0.3s ease-out;
            cursor: pointer;
        }
        #crate-wrapper:hover { transform: translate(-50%, -50%) scale(1.02); }
        #crate-wrapper.shake {
            animation: crate-shake 1.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes crate-shake {
            10%, 90% { transform: translate(-50%, -50%) rotate(-1deg); }
            20%, 80% { transform: translate(-50%, -50%) rotate(2deg); }
            30%, 50%, 70% { transform: translate(-52%, -52%) rotate(-4deg); }
            40%, 60% { transform: translate(-48%, -48%) rotate(4deg); }
        }

        #flash-overlay {
            transition: opacity 0.5s ease-out;
        }
        #flash-overlay.flash {
            animation: screen-flash 0.4s ease-out;
        }
        @keyframes screen-flash {
            0% { opacity: 0.7; background-color: #ffae42; }
            100% { opacity: 0; }
        }

        .shell-piece {
            position: absolute;
            pointer-events: none;
            will-change: transform, opacity;
        }
        
        .skin-display {
            opacity: 0;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            transition: transform 1s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.5s;
        }
        .skin-display.stacked {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.5);
        }
        
        .skin-animator.wiggling {
            animation-name: wiggle;
            animation-timing-function: ease-in-out;
            animation-iteration-count: infinite;
        }

        .skin-image {
            transition: transform 0.3s ease;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3));
        }
        .skin-display:hover .skin-image {
             transform: scale(1.15) rotate(-5deg) translateY(-10px);
        }
        
        @keyframes wiggle {
            0%   { transform: translate(0px, 0px) rotate(0deg); }
            25%  { transform: translate(-5px, -8px) rotate(-3deg); }
            50%  { transform: translate(0px, 0px) rotate(0deg); }
            75%  { transform: translate(5px, -8px) rotate(3deg); }
            100% { transform: translate(0px, 0px) rotate(0deg); }
        }

        .skin-glow-legendary {
            animation: skin-glow-legendary-anim 2s ease-in-out infinite alternate;
        }
        @keyframes skin-glow-legendary-anim {
            from { filter: drop-shadow(0 0 10px #ffd700) drop-shadow(0 0 15px #ffffff); }
            to { filter: drop-shadow(0 0 20px #ffec80) drop-shadow(0 0 30px #ffffff); }
        }

        .skin-glow-epic {
            animation: skin-glow-epic-anim 3s ease-in-out infinite;
        }
        @keyframes skin-glow-epic-anim {
            0% { filter: drop-shadow(0 0 15px #d946ef); }
            50% { filter: drop-shadow(0 0 25px #a855f7); }
            100% { filter: drop-shadow(0 0 15px #d946ef); }
        }

        /* --- Modal Styles --- */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            transition: opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="text-white">
    <div id="start-screen" class="absolute inset-0 z-50 p-4 md:p-8 flex flex-col items-center justify-center">
        <h1 class="text-4xl sm:text-5xl md:text-7xl font-bold text-white text-center mb-6 md:mb-10" style="text-shadow: 0 4px 8px rgba(251, 133, 0, 0.4);">LOOT CRATE</h1>
        
        <div class="w-full max-w-4xl">
            <h2 class="text-xl md:text-2xl font-bold text-yellow-400 mb-4 text-center">1. CHOOSE YOUR CRATE</h2>
            <div id="crate-selection" class="selection-grid bg-black/20 p-4 rounded-2xl mb-6 md:mb-8">
                <div class="selection-item p-2" data-crate-src="https://i.imgur.com/uVNYpWa.png">
                    <img src="https://i.imgur.com/uVNYpWa.png" class="w-full h-full object-contain" onerror="this.onerror=null;this.src='https://placehold.co/200x200/a855f7/ffffff?text=Purple+Crate';">
                    <div class="checkmark">✔</div>
                </div>
                 <div class="selection-item p-2" data-crate-src="https://1.bp.blogspot.com/-HzouOVi24ps/YEYR15ZLwUI/AAAAAAAAACY/bxttbJLw2tAAyh0mSD1PcL0be6E497-ZgCLcBGAsYHQ/s16000/pc.png">
                    <img src="https://1.bp.blogspot.com/-HzouOVi24ps/YEYR15ZLwUI/AAAAAAAAACY/bxttbJLw2tAAyh0mSD1PcL0be6E497-ZgCLcBGAsYHQ/s16000/pc.png" class="w-full h-full object-contain" onerror="this.onerror=null;this.src='https://placehold.co/200x200/3b82f6/ffffff?text=Weapon+Crate';">
                    <div class="checkmark">✔</div>
                </div>
                 <div class="selection-item p-2" data-crate-src="https://i.imgur.com/NIIp2d8.png">
                    <img src="https://i.imgur.com/NIIp2d8.png" class="w-full h-full object-contain" onerror="this.onerror=null;this.src='https://placehold.co/200x200/ef4444/ffffff?text=Red+Crate';">
                    <div class="checkmark">✔</div>
                </div>
            </div>

            <h2 class="text-xl md:text-2xl font-bold text-yellow-400 mb-4 text-center">2. CHOOSE 2 TO 4 SKINS</h2>
            <div id="skin-selection" class="selection-grid bg-black/20 p-4 rounded-2xl max-h-48 md:max-h-64 overflow-y-auto">
                <!-- Skins will be populated by JS -->
            </div>
        </div>

        <button id="start-button" class="action-button font-bold mt-6 md:mt-8 px-8 py-3 text-2xl md:px-10 md:py-4 md:text-3xl rounded-lg border-4" disabled>OPEN CRATE!</button>
    </div>

    <div id="game-container" class="hidden">
        <div id="flash-overlay" class="fixed inset-0 bg-white opacity-0 pointer-events-none z-50"></div>
        
        <div id="crate-wrapper" class="flex items-center justify-center">
            <img id="crate-image" src="" alt="A Free Fire Crate" class="w-full h-full object-contain" onerror="this.onerror=null;this.src='https://placehold.co/450x450/3b82f6/ffffff?text=Weapon+Crate';">
        </div>
        
        <div id="shell-container" class="absolute inset-0 w-full h-full pointer-events-none"></div>

        <div id="skins-container" class="absolute inset-0 w-full h-full pointer-events-none">
            <!-- Chosen skins will be populated here -->
        </div>
        
        <button id="get-skins-button" class="action-button font-bold w-11/12 max-w-xs px-6 py-3 text-xl md:px-8 md:py-4 md:text-3xl rounded-lg border-4 absolute bottom-10 left-1/2 -translate-x-1/2 opacity-0 transition-opacity duration-500 pointer-events-none">CLAIM SKINS</button>
    </div>

    <!-- Nickname Modal -->
    <div id="nickname-modal" class="modal-overlay hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="bg-slate-800 border-2 border-slate-600 rounded-lg shadow-2xl p-6 md:p-8 w-full max-w-md text-center">
            <h2 class="text-2xl md:text-3xl font-bold text-yellow-400 mb-4">Claim Your Skins!</h2>
            <p class="text-slate-300 mb-6">Enter your username to add these skins to your inventory.</p>
            <form id="nickname-form">
                <input type="text" id="nickname-input" placeholder="Enter username..." class="w-full px-4 py-3 bg-slate-700 border-2 border-slate-500 rounded-lg text-lg text-white focus:ring-2 focus:ring-yellow-400 focus:border-transparent outline-none" required>
                <button type="submit" class="action-button w-full mt-4 font-bold px-8 py-3 text-lg md:text-xl rounded-lg border-4">Claim</button>
            </form>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="modal-overlay hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="bg-slate-800 border-2 border-slate-600 rounded-lg shadow-2xl p-8 w-full max-w-md text-center cursor-pointer">
            <h2 class="text-2xl md:text-3xl font-bold text-green-500 mb-4">Success!</h2>
            <p class="text-slate-300">Your new skins have been added to your inventory!</p>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const startScreen = document.getElementById('start-screen');
        const crateSelectionContainer = document.getElementById('crate-selection');
        const skinSelectionContainer = document.getElementById('skin-selection');
        const startButton = document.getElementById('start-button');
        
        const gameContainer = document.getElementById('game-container');
        const crateWrapper = document.getElementById('crate-wrapper');
        const crateImage = document.getElementById('crate-image');
        const shellContainer = document.getElementById('shell-container');
        const skinsContainer = document.getElementById('skins-container');
        const flashOverlay = document.getElementById('flash-overlay');
        const getSkinsButton = document.getElementById('get-skins-button');
        
        const nicknameModal = document.getElementById('nickname-modal');
        const successModal = document.getElementById('success-modal');
        const nicknameForm = document.getElementById('nickname-form');

        // --- Game State ---
        let isOpening = false;
        let animationFrameId;
        let shellPieces = [];
        let selectedCrateSrc = '';
        let selectedSkins = [];
        
        const skinOptions = [
            { name: "Naruto", url: "https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/84dc13b7-a2e7-4b45-83ec-311e72e82900/dd1yssl-1e7de36d-0ca3-4aa0-8756-eddb321aeca1.png/v1/fill/w_320,h_510/naruto__uzumaki_render_2__naruto_online__by_maxiuchiha22_dd1yssl-fullview.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9NTEwIiwicGF0aCI6IlwvZlwvODRkYzEzYjctYTJlNy00YjQ1LTgzZWMtMzExZTcyZTgyOTAwXC9kZDF5c3NsLTFlN2RlMzZkLTBjYTMtNGFhMC04NzU2LWVkZGIzMjFhZWNhMS5wbmciLCJ3aWR0aCI6Ijw9MzIwIn1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmltYWdlLm9wZXJhdGlvbnMiXX0.kn75TOnddyay_C3gSQQ5X1_0c0JHC15cwIyI-Yi6YQE" },
            { name: "Sakura", url: "https://i.ibb.co/Z6BJzq67/Diseno-sin-titulo-1.png" },
            { name: "Itachi", url: "https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/d5be6641-71c2-4fcb-a942-e159550c3152/d8tfx1v-aae4e7bf-7c3a-45ae-95f1-4926f792ebd3.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7InBhdGgiOiJcL2ZcL2Q1YmU2NjQxLTcxYzItNGZjYi1hOTQyLWUxNTk1NTBjMzE1MlwvZDh0Zngxdi1hYWU0ZTdiZi03YzNhLTQ1YWUtOTVmMS00OTI2Zjc5MmViZDMucG5nIn1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmZpbGUuZG93bmxvYWQiXX0.roPM40TOvZVLgPlycdqHVXRWlJRZVWqQwcBim1Cumy4" },
            { name: "Minato", url: "https://static.wikia.nocookie.net/naruto-ultimate-ninja-storm/images/2/25/Minato.png/revision/latest" },
            { name: "Criminal 1", url: "https://i.ibb.co/84ssxmkc/oardefault.png" },
            { name: "Criminal 2", url: "https://static.wikia.nocookie.net/garena-freefire/images/8/8a/Red_Criminal_Bundle.png/revision/latest" },
            { name: "Criminal 3", url: "https://static.wikia.nocookie.net/garena-freefire/images/1/1b/Green_Criminal_Bundle.png/revision/latest" }
        ];

        // --- Start Screen Logic ---
        function populateSkins() {
            skinOptions.forEach(skin => {
                const skinItem = document.createElement('div');
                skinItem.className = 'selection-item p-2';
                skinItem.dataset.skinUrl = skin.url;
                skinItem.dataset.skinName = skin.name;
                skinItem.innerHTML = `
                    <img src="${skin.url}" class="w-full h-full object-contain rounded-lg bg-white/10" onerror="this.onerror=null;this.src='https://placehold.co/200x200/1e293b/fb8500?text=${encodeURIComponent(skin.name)}';">
                    <div class="checkmark">✔</div>
                `;
                skinSelectionContainer.appendChild(skinItem);
            });
        }

        function updateStartButton() {
            if (selectedCrateSrc && selectedSkins.length >= 2 && selectedSkins.length <= 4) {
                startButton.disabled = false;
            } else {
                startButton.disabled = true;
            }
        }

        crateSelectionContainer.addEventListener('click', (e) => {
            const item = e.target.closest('.selection-item');
            if (!item) return;
            
            if (item.classList.contains('selected')) {
                item.classList.remove('selected');
                selectedCrateSrc = '';
            } else {
                crateSelectionContainer.querySelectorAll('.selection-item').forEach(el => el.classList.remove('selected'));
                item.classList.add('selected');
                selectedCrateSrc = item.dataset.crateSrc;
            }
            updateStartButton();
        });

        skinSelectionContainer.addEventListener('click', (e) => {
            const item = e.target.closest('.selection-item');
            if (!item) return;

            const skinUrl = item.dataset.skinUrl;
            const skinName = item.dataset.skinName;
            const skinData = { url: skinUrl, name: skinName };

            const index = selectedSkins.findIndex(s => s.url === skinUrl);

            if (index > -1) {
                selectedSkins.splice(index, 1);
                item.classList.remove('selected');
            } else {
                if (selectedSkins.length < 4) {
                    selectedSkins.push(skinData);
                    item.classList.add('selected');
                }
            }
            updateStartButton();
        });

        startButton.addEventListener('click', () => {
            if (selectedCrateSrc && selectedSkins.length >= 2 && selectedSkins.length <= 4) {
                crateImage.src = selectedCrateSrc;
                
                skinsContainer.innerHTML = '';
                selectedSkins.forEach((skin, i) => {
                    const skinDisplay = document.createElement('div');
                    skinDisplay.id = `skin${i + 1}`;
                    skinDisplay.className = 'skin-display w-1/2 md:w-1/3';
                    
                    const glowClass = Math.random() > 0.3 ? 'skin-glow-legendary' : 'skin-glow-epic';

                    skinDisplay.innerHTML = `
                        <div class="skin-animator">
                            <img src="${skin.url}" class="skin-image ${glowClass} w-full h-auto object-contain max-w-xs" onerror="this.onerror=null;this.src='https://placehold.co/300x300/1e293b/fb8500?text=${encodeURIComponent(skin.name)}';">
                        </div>
                    `;
                    skinsContainer.appendChild(skinDisplay);
                });

                startScreen.style.opacity = '0';
                setTimeout(() => {
                    startScreen.classList.add('hidden');
                    gameContainer.classList.remove('hidden');
                }, 500);
            }
        });


        // --- Game Logic ---
        function animateShells() {
            if (shellPieces.length === 0) {
                cancelAnimationFrame(animationFrameId);
                return;
            }
            const gravity = 0.5;
            shellPieces.forEach((piece, index) => {
                piece.vy += gravity;
                piece.x += piece.vx;
                piece.y += piece.vy;
                piece.rotation += piece.rotationSpeed;
                piece.element.style.transform = `translate(${piece.x}px, ${piece.y}px) rotate(${piece.rotation}deg)`;
                if (piece.y > window.innerHeight + 100) {
                    piece.element.remove();
                    shellPieces.splice(index, 1);
                }
            });
            animationFrameId = requestAnimationFrame(animateShells);
        }

        function createCrateFragments() {
            shellContainer.innerHTML = '';
            shellPieces = [];
            const crateRect = crateWrapper.getBoundingClientRect();
            const crateImageUrl = crateImage.src;

            const rows = 8;
            const cols = 8;
            const pieceWidth = crateRect.width / cols;
            const pieceHeight = crateRect.height / rows;

            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    const element = document.createElement('div');
                    element.classList.add('shell-piece');
                    element.style.backgroundImage = `url(${crateImageUrl})`;
                    element.style.backgroundSize = `${crateRect.width}px ${crateRect.height}px`;
                    element.style.backgroundPosition = `-${j * pieceWidth}px -${i * pieceHeight}px`;
                    element.style.width = `${pieceWidth}px`;
                    element.style.height = `${pieceHeight}px`;
                    
                    const startX = crateRect.left + j * pieceWidth;
                    const startY = crateRect.top + i * pieceHeight;
                    
                    element.style.left = `${startX}px`;
                    element.style.top = `${startY}px`;

                    shellContainer.appendChild(element);
                    
                    const angle = Math.random() * 360;
                    const speed = Math.random() * 25 + 15;
                    
                    shellPieces.push({
                        element: element,
                        x: 0, y: 0,
                        vx: Math.cos(angle * Math.PI / 180) * speed + (Math.random() - 0.5) * 10,
                        vy: Math.sin(angle * Math.PI / 180) * speed - 25,
                        rotation: 0,
                        rotationSpeed: Math.random() * 20 - 10,
                    });
                }
            }
            animateShells();
        }

        function openCrate() {
            if (isOpening) return;
            isOpening = true;
            
            crateWrapper.classList.add('shake');

            setTimeout(() => {
                crateWrapper.style.opacity = '0';
                document.body.classList.add('screen-shake-active');
                flashOverlay.classList.add('flash');
                setTimeout(() => {
                    flashOverlay.classList.remove('flash');
                    document.body.classList.remove('screen-shake-active');
                }, 500);

                createCrateFragments();

                setTimeout(() => {
                    document.querySelectorAll('#skins-container .skin-display').forEach(skin => skin.classList.add('stacked'));
                }, 400);

                setTimeout(() => {
                    const skins = skinsContainer.querySelectorAll('.skin-display');
                    const count = skins.length;

                    const positions = {
                        2: [`translate(-80%, -75%) scale(1.2)`, `translate(-20%, -75%) scale(1.2)`],
                        3: [`translate(-100%, -60%) scale(1.2)`, `translate(-50%, -110%) scale(1.2)`, `translate(0%, -40%) scale(1.2)`],
                        4: [`translate(-120%, -90%) scale(1.2)`, `translate(20%, -90%) scale(1.2)`, `translate(-120%, -30%) scale(1.2)`, `translate(20%, -30%) scale(1.2)`]
                    };
                    
                    if (positions[count]) {
                        skins.forEach((skin, i) => {
                            skin.style.transform = positions[count][i];
                        });
                    }
                    
                    skins.forEach(skin => {
                        const animator = skin.querySelector('.skin-animator');
                        skin.addEventListener('transitionend', () => {
                            const duration = Math.random() * 2 + 2;
                            animator.style.animationDuration = `${duration}s`;
                            animator.classList.add('wiggling');
                        }, { once: true });
                    });

                }, 1000);
                
                setTimeout(() => {
                    getSkinsButton.classList.remove('opacity-0', 'pointer-events-none');
                }, 2500);

            }, 1500);
        }

        function resetAnimation() {
            if (!isOpening) return;
            
            document.querySelectorAll('#skins-container .skin-display').forEach(skin => {
                skin.classList.remove('stacked');
                const animator = skin.querySelector('.skin-animator');
                animator.classList.remove('wiggling');
                animator.style.animationDuration = '';
                skin.style.transform = 'translate(-50%, -50%) scale(0)';
            });

            getSkinsButton.classList.add('opacity-0', 'pointer-events-none');
            nicknameModal.classList.add('hidden');
            nicknameModal.classList.remove('flex');
            successModal.classList.add('hidden');
            successModal.classList.remove('flex');

            setTimeout(() => {
                shellContainer.innerHTML = '';
                shellPieces = [];
                cancelAnimationFrame(animationFrameId);
                crateWrapper.classList.remove('shake');
                crateWrapper.style.opacity = '1';
                isOpening = false;

                startScreen.classList.remove('hidden');
                setTimeout(() => startScreen.style.opacity = '1', 50);
                gameContainer.classList.add('hidden');
            }, 500);
        }
        
        // --- Initialization and Event Listeners ---
        
        populateSkins();
        updateStartButton();

        crateWrapper.addEventListener('click', (event) => {
            event.stopPropagation(); 
            if (!isOpening) {
                openCrate();
            }
        });

        gameContainer.addEventListener('click', (e) => {
            if (isOpening && e.target === gameContainer) {
                 resetAnimation();
            }
        });

        getSkinsButton.addEventListener('click', (e) => {
            e.stopPropagation();
            nicknameModal.classList.remove('hidden');
            nicknameModal.classList.add('flex');
        });

        nicknameForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const claimedSkinNames = selectedSkins.map(s => s.name).join(', ');
            console.log(`User: ${document.getElementById('nickname-input').value} claimed skins: ${claimedSkinNames}`);
            nicknameModal.classList.add('hidden');
            nicknameModal.classList.remove('flex');
            successModal.classList.remove('hidden');
            successModal.classList.add('flex');
        });

        successModal.addEventListener('click', () => {
             resetAnimation();
        });
    </script>
</body>
</html>
